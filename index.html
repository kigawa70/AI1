<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å‹•çš„RSSãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªãƒ¼ãƒ€ãƒ¼ with Gemini API</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        #category-select button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .news-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .news-item h3 { margin-top: 0; }
        .tags { font-size: 0.9em; color: #555; margin-top: 5px; }
        .loading { color: orange; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ“° ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ‹ãƒ¥ãƒ¼ã‚¹</h1>
    
    <div id="category-select">
        <button onclick="fetchNews('tech')">ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼</button>
        <button onclick="fetchNews('business')">ãƒ“ã‚¸ãƒã‚¹</button>
        <button onclick="fetchNews('entertainment')">ã‚¨ãƒ³ã‚¿ãƒ¡</button>
    </div>

    <hr>
    
    <h2 id="current-category">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
    <div id="news-list">
        </div>

    <script>
        /**
         * é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ã—ã€è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         * @param {string} categoryKey ã‚µãƒ¼ãƒãƒ¼APIã«å¯¾å¿œã™ã‚‹ã‚«ãƒ†ã‚´ãƒªã‚­ãƒ¼
         */
        async function fetchNews(categoryKey) {
            const newsListElement = document.getElementById('news-list');
            const currentCategoryElement = document.getElementById('current-category');
            
            // ç”»é¢è¡¨ç¤ºã«è‡³ã‚‹ã¾ã§ã®ãƒ­ã‚¸ãƒƒã‚¯:
            // 1. ç”»é¢ã®åˆæœŸåŒ–ã¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            currentCategoryElement.textContent = `ã‚«ãƒ†ã‚´ãƒª: ${categoryKey} (èª­ã¿è¾¼ã¿ä¸­...)`;
            newsListElement.innerHTML = '<p class="loading">ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨AIã‚¿ã‚°ã‚’ç”Ÿæˆä¸­...</p>'; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

            try {
                // 2. ã‚µãƒ¼ãƒãƒ¼APIã‚’å‘¼ã³å‡ºã™ (ã‚«ãƒ†ã‚´ãƒªå¤‰æ›´ã‹ã‚‰è¡¨ç¤ºã«è‡³ã‚‹ã¾ã§ã®æ ¸)
                // ã“ã®APIå‘¼ã³å‡ºã—ã§ã€ã‚µãƒ¼ãƒãƒ¼ã¯RSSå–å¾—ã€ãƒ‘ãƒ¼ã‚¹ã€Gemini APIå‘¼ã³å‡ºã—ã‚’è¡Œã†
                const response = await fetch(`/api/news/${categoryKey}`);
                
                if (!response.ok) {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                
                // 3. ãƒ‹ãƒ¥ãƒ¼ã‚¹ä¸€è¦§ã®HTMLã‚’æ§‹ç¯‰
                let newsHtml = '';
                data.news.forEach(item => {
                    newsHtml += `
                        <div class="news-item">
                            <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                            <div class="tags">ğŸ·ï¸ AIã‚¿ã‚°: ${item.aiTags}</div>
                            <small>${new Date(item.pubDate).toLocaleDateString()}</small>
                        </div>
                    `;
                });

                // 4. ç”»é¢ã‚’æ›´æ–°
                currentCategoryElement.textContent = `ã‚«ãƒ†ã‚´ãƒª: ${data.category}`;
                newsListElement.innerHTML = newsHtml;

            } catch (error) {
                console.error("ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
                newsListElement.innerHTML = `<p style="color: red;">ã‚¨ãƒ©ãƒ¼: ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ (${error.message})</p>`;
            }
        }
    </script>
</body>
</html>